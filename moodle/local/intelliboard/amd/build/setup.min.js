define(["jquery","local_intelliboard/setup_moodle_settings","local_intelliboard/setup_terms","local_intelliboard/setup_authentication"],function(a,b,c,d){var e={activeRequest:!1,serviceToken:"",useRestProtocol:!0,init:function(){e.moodleSettingsHandler(),e.termsHandler()},moodleSettingsHandler:function(){a(".moodle-settings .tab-header-button button.next").unbind("click"),a(".moodle-settings .tab-header-button button.next").on("click",function(){e.activeRequest||(e.activeRequest=!0,b.hideErrors(),b.loaderContainer.removeClass("hidden"),b.save(function(d){e.activeRequest=!1,b.loaderContainer.addClass("hidden"),"success"===d.status?(e.serviceToken=JSON.parse(d.data).token,e.useRestProtocol=a("#rest_protocol").is(":checked"),b.closeTab(),c.openTab()):b.showErrors(d.data)}))}),a(".moodle-settings .choose-group .item").unbind("click"),a(".moodle-settings .choose-group .item").on("click",function(){a(".moodle-settings .choose-group .item").removeClass("active"),a(".moodle-settings .choose-group .item input").prop("checked",!1).attr("checked",""),a(this).addClass("active"),a(this).find("input").attr("checked","checked").prop("checked",!0)})},termsHandler:function(){a(".tab-item.terms .tab-header-button button.next").unbind("click"),a(".tab-item.terms .tab-header-button button.next").on("click",function(){e.activeRequest||(c.hideErrors(),c.loaderContainer.removeClass("hidden"),c.termsIsAccepted()?(c.loaderContainer.addClass("hidden"),c.closeTab(),e.authenticationHandler()):c.showErrorMessage(function(){c.loaderContainer.addClass("hidden")}))}),a(".tab-item.terms .tab-header-button button.back").on("click",function(){c.closeTab(),b.openTab()})},authenticationHandler:function(){var b=a("#subscription_email").val();d.openTab(),d.setFormEmail(b),d.loaderContainer.removeClass("hidden"),d.checkEmail(b,function(b){b.email_exists?(d.showLoginForm(),d.loginHandler(e.serviceToken,e.useRestProtocol,function(){d.closeTab(),a(".setup-wrapper .tab-item.congrats").removeClass("closed")})):(d.showRegisterForm(),d.registerHandler(e.serviceToken,e.useRestProtocol,function(){d.closeTab(),a(".setup-wrapper .tab-item.congrats").removeClass("closed")}))}),a(".tab-item.authentication .tab-header-button button.back").on("click",function(){d.closeTab(),d.hideLoginForm(),d.hideRegisterForm(),c.openTab()})}};return e});