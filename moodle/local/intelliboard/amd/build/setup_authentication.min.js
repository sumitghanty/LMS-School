define(["jquery","core/ajax","local_intelliboard/validator","core/str"],function(a,b,c,d){var e={errorsContainer:a(".tab-item.authentication .warnings-block"),loaderContainer:a(".tab-item.authentication .loader"),showErrors:function(a){e.errorsContainer.html(a),e.errorsContainer.removeClass("hidden")},hideErrors:function(){e.errorsContainer.html(""),e.errorsContainer.addClass("hidden")},closeTab:function(){a(".tab-item.authentication").addClass("closed")},openTab:function(){a(".tab-item.authentication").removeClass("closed")},showLoginForm:function(){a(".tab-item .tab-body .login-form").removeClass("hidden")},hideLoginForm:function(){a(".tab-item .tab-body .login-form").addClass("hidden")},showRegisterForm:function(){a(".tab-item .tab-body .register-form").removeClass("hidden")},hideRegisterForm:function(){a(".tab-item .tab-body .register-form").addClass("hidden")},setFormEmail:function(b){a("#loginEmail").val(b),a("#registerEmail").val(b)},checkEmail:function(d,e){if(c.validateEmail(d)){var f=b.call([{methodname:"local_intelliboard_setup_check_email",args:{email:a("#subscription_email").val()}}]);f[0].done(function(a){e(a)}),f[0].fail(function(){e({email_exists:!1})})}else e({email_exists:!1})},loginHandler:function(c,f,g){e.loaderContainer.addClass("hidden"),a(".tab-body .login-form .sign-in").unbind("click"),a(".tab-body .login-form .sign-in").on("click",function(){var h=a("#loginEmail").val(),i=a("#loginPassword").val();if(e.loaderContainer.removeClass("hidden"),e.hideErrors(),h&&i){var j=b.call([{methodname:"local_intelliboard_setup_login",args:{email:h,password:i,moodle_service_token:c,restProtocol:f}}]);j[0].done(function(a){e.loaderContainer.addClass("hidden"),"error"===a.status?e.showErrors(a.message):g()}),j[0].fail(function(){var b=d.get_string("server_error","local_intelliboard");a.when(b).done(function(a){e.loaderContainer.addClass("hidden"),e.showErrors("<p>"+a+"</p>")})})}else{var k=d.get_string("all_fields_required","local_intelliboard");a.when(k).done(function(a){e.loaderContainer.addClass("hidden"),e.showErrors(a)})}})},registerHandler:function(c,f,g){e.loaderContainer.addClass("hidden"),a(".tab-body .register-form .sign-up").unbind("click"),a(".tab-body .register-form .sign-up").on("click",function(){var h=a("#registerEmail").val(),i=a("#registerPassword").val(),j=a("#registerName").val();if(e.loaderContainer.removeClass("hidden"),e.hideErrors(),h&&i&&j){var k=b.call([{methodname:"local_intelliboard_setup_register",args:{name:j,email:h,password:i,country:a("#registerCountry").val(),moodle_service_token:c,restProtocol:f}}]);k[0].done(function(a){e.loaderContainer.addClass("hidden"),"error"===a.status?e.showErrors(a.message):g()}),k[0].fail(function(){var b=d.get_string("server_error","local_intelliboard");a.when(b).done(function(a){e.loaderContainer.addClass("hidden"),e.showErrors("<p>"+a+"</p>")})})}else{var l=d.get_string("all_fields_required","local_intelliboard");a.when(l).done(function(a){e.loaderContainer.addClass("hidden"),e.showErrors(a)})}})}};return e});